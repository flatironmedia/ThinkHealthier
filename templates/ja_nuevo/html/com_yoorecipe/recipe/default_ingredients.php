<?php/*------------------------------------------------------------------------# com_yoorecipe -  YooRecipe! Joomla 2.5 & 3.x recipe component# ------------------------------------------------------------------------# author    YooRock!# copyright Copyright (C) 2011 yoorock.fr. All Rights Reserved.# @license - http://www.gnu.org/licenses/gpl-2.0.html GNU/GPL# Websites: http://www.yoorecipe.com# Technical Support:  Forum - http://www.yoorecipe.com/-------------------------------------------------------------------------*/// No direct access to this filedefined('_JEXEC') or die('Restricted access');jimport('joomla.environment.browser');$document 	= JFactory::getDocument();$user 		= JFactory::getUser();$browser 	= JBrowser::getInstance();// Component Parameters$yooRecipeparams 		= JComponentHelper::getParams('com_yoorecipe');$use_quantity_converter	= $yooRecipeparams->get('use_quantity_converter', 1);$show_slider_tooltip	= $yooRecipeparams->get('show_slider_tooltip', 0);$max_servings			= $yooRecipeparams->get('max_servings', 10);$currency				= $yooRecipeparams->get('currency', '&euro;');$use_fractions			= $yooRecipeparams->get('use_fractions', 0);$recipe 	= $this->recipe;$use_html5_range_input = ($browser->getBrowser() != 'mozilla' && $browser->getBrowser() != 'msie') ? true : false;$use_html5_range_input = 1;$document->addScript('media/com_yoorecipe/js/generic.js');?><h3><?php echo JText::_('COM_YOORECIPE_RECIPES_INGREDIENTS'); ?></h3><p><?php	echo JText::_('COM_YOORECIPE_FOR'),' ','<span itemprop="recipeYield" ><span id="spanNbPersons" class="servingsize">',$recipe->nb_persons,'</span> ',JText::_('COM_YOORECIPE_SERVING_TYPE_'.$recipe->servings_type_code),'</span>';?></p><?php	if ($use_quantity_converter && $recipe->use_slider) {		if ($use_html5_range_input) {						$script = array();			$script[] = "window.addEvent('domready', function () {";			$script[] = "updateQuantities = function() {";			$script[] = "nb_servings = $('slider').value;";			$script[] = "var quantities = ".json_encode($this->recipe->quantities).";";			$script[] = "$('spanNbPersons').set('html',nb_servings);";				$script[] = "var inputs = document.getElementsByTagName('input');";			$script[] = "for (i = 0 ; i < inputs.length ; i++) {";			$script[] = "if (inputs[i].name == 'ingredientId') {";						$script[] = "var newQty = quantities[inputs[i].value][nb_servings];";			$script[] = "if (newQty != 0) {";			$script[] = "$('spanQuantity_' + inputs[i].value).set('html',newQty);";			$script[] = "} else {";			$script[] = "$('spanQuantity_' + inputs[i].value).set('html','');";			$script[] = "}";				$script[] = "}";			$script[] = "}";				$script[] = "}});";				$document->addScriptDeclaration(implode("\n", $script));?>	<input type="range" id="slider" name="slider" min="1" max="<?php echo $max_servings; ?>" step="1" value="<?php echo $recipe->nb_persons; ?>" onchange="updateQuantities();"/><?php 	}				else {				if ($show_slider_tooltip) {?>	<div tabindex="1" id="slider-1" class="horizontal dynamic-slider-control slider hasTip" title="<?php echo JText::_('COM_YOORECIPE_SLIDER') . '::' . JText::_('COM_YOORECIPE_SLIDER_TOOLTIP') ?>">	<?php } else { ?>	<div tabindex="1" id="slider-1" class="horizontal dynamic-slider-control slider">	<?php }?>			<input id="slider-input-1" class="slider-input"/>		<div class="line" style="top: 11px; left: 15.5px; width: 150px;">			<div style="width: 150px;"></div>		</div>				<script type="text/javascript">//<![CDATA[	var s = new YooSlider($('slider-1'), $('slider-input-1'));	var quantities = <?php echo json_encode($this->recipe->quantities); ?>;	s.onchange = function () {		$('spanNbPersons').set('html',s.getValue());		var inputs = document.getElementsByTagName('input');		for (i = 0 ; i < inputs.length ; i++) {			if (inputs[i].name == 'ingredientId') {				var newQty = quantities[inputs[i].value][s.getValue()];				if (newQty != 0) {					$('spanQuantity_' + inputs[i].value).set('html',newQty);				} else {					$('spanQuantity_' + inputs[i].value).set('html','');				}			}		}	};	s.setValue(<?php echo $recipe->nb_persons; ?>);	s.setMinimum(1);	s.setMaximum(<?php echo $max_servings; ?>);	alert(s.getValue());	/* ]]> */		</script>	</div><?php } } // End if ($use_quantity_converter) {	if ($recipe->groups) {				foreach ($recipe->groups as $group) {						echo '<h4>',JText::_($group->label),'</h4>';			echo '<ul class="unstyled">';			foreach ($group->ingredients as $ingredient) {							$rounded_quantity = round($ingredient->quantity, 2);				echo '<li><span class="ingredient">';				echo '<input type="hidden" name="ingredientId" value="',$ingredient->id,'"/>';				echo '<input type="hidden" id="initialQuantity_',$ingredient->id,'" value="',$rounded_quantity,'"/>';								$quantity = ($use_fractions) ? JHtml::_('ingredientutils.decimalToFraction', $rounded_quantity) : $rounded_quantity;				if ($quantity == 0) {$quantity = '';}				echo '<span id="spanQuantity_',$ingredient->id,'" class="amount">',$quantity,'</span> ',$ingredient->unit,' <span class="name" itemprop="ingredients">',htmlspecialchars($ingredient->description),'</span>';				echo '</span></li>';							} // End foreach ($group->ingredients as $ingredient) {						echo '</ul>';					} // End foreach ($recipe->groups as $group) {			} // End if ($recipe->groups) { ?>